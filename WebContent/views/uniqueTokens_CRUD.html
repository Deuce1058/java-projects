<!DOCTYPE html>
<html>
<head>
  <meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
  <meta HTTP-EQUIV="Expires" CONTENT="-1">
  <meta charset="utf-8">
  <title>Unique Tokens CRUD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="../resources/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../resources/fontawesome-free-5.12.1-web/css/all.min.css" rel="stylesheet" />
  <link href="../resources/fontawesome-free-5.12.1-web/css/fontawesome.min.css" rel="stylesheet">
  <link href="../resources/fontawesome-free-5.12.1-web/css/brands.min.css" rel="stylesheet" />
  <link href="../resources/fontawesome-free-5.12.1-web/css/solid.min.css" rel="stylesheet" />
  <script defer src="../resources/fontawesome-free-5.12.1-web/js/all.min.js"></script>
  <script defer src="../resources/fontawesome-free-5.12.1-web/js/brands.min.js"></script>
  <script defer src="../resources/fontawesome-free-5.12.1-web/js/solid.min.js"></script>
  <script defer src="../resources/fontawesome-free-5.12.1-web/js/fontawesome.min.js"></script>
  <script src="../resources/scripts/jquery-3.4.1.min.js"></script>
  <script src="../resources/scripts/bootstrap.min.js"></script>
  <script src="../resources/scripts/momentJS/moment.min.js" type="text/javascript"></script>
  <script src="../resources/scripts/bootstrap4-datetimepicker/tempusdominus-bootstrap-4.min.js" type="text/javascript"></script>
  <link href="../resources/css/bootstrap4-datetimepicker/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
  <script src="../resources/scripts/globalizeJS/cldrjs/dist/cldr.js"></script>
  <script src="../resources/scripts/globalizeJS/cldrjs/dist/cldr/event.js"></script>
  <script src="../resources/scripts/globalizeJS/cldrjs/dist/cldr/supplemental.js"></script>
  <script src="../resources/scripts/globalizeJS/globalize/dist/globalize.js"></script>
  <script src="../resources/scripts/globalizeJS/globalize/dist/globalize/number.js"></script>
  <script src="../resources/scripts/globalizeJS/globalize/dist/globalize/date.js"></script>
  <script src="../resources/scripts/custom/enCldrDate.js"></script>
  <style type="text/css">
    body{
      padding-top: 0px;
    }
    .userProfileForm {
      margin-left: 0px;
    }
    .formElementPadBottom {
      padding-bottom: 10px;
    }
    .formElementPadLeft {
      padding-left: 5px;
    }
    .formElementPadBottomLeft {
      padding-bottom: 10px;
      padding-left: 5px;
    }
    .roundedCorners {
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      border-radius: 4px;
      border-style: solid;
      border-width: 1px;
    }
    .preserveWhiteSpace {
      white-space: pre;
    }
    .dropdown-submenu {
      position: relative;
    }
    .dropdown-submenu>.dropdown-menu {
      top: 0;
      left: 100%;
      margin-top: -6px;
      margin-left: -1px;
      -webkit-border-radius: 0 6px 6px 6px;
      -moz-border-radius: 0 6px 6px;
      border-radius: 0 6px 6px 6px;
    }
    .dropdown-submenu:hover>.dropdown-menu {
      display: block;
    }
    .dropdown-submenu>a:after {
      display: block;
      content: " ";
      float: right;
      width: 0;
      height: 0;
      border-color: transparent;
      border-style: solid;
      border-width: 5px 0 5px 5px;
      border-left-color: #ccc;
      margin-top: 5px;
      margin-right: -10px;
    }
    .dropdown-submenu:hover>a:after {
      border-left-color: #fff;
    }
    .dropdown-submenu.pull-left {
      float: none;
    }
    .dropdown-submenu.pull-left>.dropdown-menu {
      left: -100%;
      margin-left: 10px;
      -webkit-border-radius: 6px 0 6px 6px;
      -moz-border-radius: 6px 0 6px 6px;
      border-radius: 6px 0 6px 6px; 
    }
    table {
      width: 100%;
    }
    thead, tbody, tr, td, th { display: block; }
    tr:after {
      content: ' ';
      display: block;
      visibility: hidden;
      clear: both;
    }
    thead th {
      height: 30px;
    }
    tbody {
      height: 700px;
      overflow-y: auto;
    }
    tbody td, thead th {
      float: left;
    }
    .orange {
      color: darkorange;
    }
    .mediumRedBorder {
      border-color: red;
      border-style: solid;
      border-width: medium;
    }
    .white {
      color: white;
    }
    .align-center {
      text-align: center;
    }
    .background-red {
      background-color:red;
    }
  </style>
  <h4 class="white align-center background-red">
    <noscript>This site requires JavaScript. Ensure that this is enabled on your browser.</noscript>
  </h4>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom border-bottom">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Quick Links<span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu  multi-level" role="menu" aria-labelledby="dropdownMenu">
                        <li class="dropdown-submenu">
                            <a tabindex="-1" href="#">User Tables</a>
                            <ul class="dropdown-menu" style="width: 250px;">
                                <li id="UPView"><a href="#">View User Profile</a></li>
                                <li id="UPChange"><a href="#">User Profile Maintenance</a></li>
                                <li id="STView"><a href="#">View Sessions Table</a></li>
                                <li id="STChange"><a href="#">Sessions Table Maintenance</a></li>
                                <li id="UP1View"><a href="#">View Unique Tokens Table</a></li>
                                <li id="UP1Change"><a href="#">Unique Tokens Table Maintenance</a></li>
                                <li id="UGView"><a href="#">View User Groups Table</a></li>
                                <li id="UGChange"><a href="#">User Groups Table Maintenance</a></li>
                            </ul>
                        </li>

                        <li class="dropdown-submenu">
                            <a href="#">Permissions</a>
                            <ul class="dropdown-menu" style="width: 250px;">
                                <li id="PMView"><a href="#">View Permissions Master</a></li>
                                <li id="PMChange"><a href="#">Permissions Master Maintenance</a></li>
                                <li id="GPView"><a href="#">View Group Permissions</a></li>
                                <li id="GPChange"><a href="#">Group Permissions Maintenance</a></li>
                            </ul>
                        </li>

                        <li class="dropdown-submenu">
                            <a href="#">Misc.</a>
                            <ul class="dropdown-menu" style="width: 250px;">
                                <li id="GMView"><a href="#">View Group Master</a></li>
                                <li id="GMChange"><a href="#">Group Master Maintenance</a></li>
                                <li id="PPView"><a href="#">View Password Policy</a></li>
                                <li id="PPChange"><a href="#">Password Policy Maintenance</a></li>
                                <li id="STView"><a href="#">View Sessions Table</a></li>
                                <li id="STChange"><a href="#">Sessions Table Maintenance</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
            <form class="form-inline pl-2">
                <div class="form-group px-sm-1">
                    <label for="username" class="control-label preserveWhiteSpace" style="padding-left: 20px;"><strong>Username </strong></label>
                    <input type="search" class="form-control" name="username" id="username" required placeholder="User Name" aria-label="Username">
                </div>
                <button type="submit" class="btn btn-success" id="findBtn">Find</button>
            </form>
            <div id="title-loginID" class="formElementPadLeft preserveWhiteSpace"></div>
            <div id="form-feedback" class="formElementPadLeft" style="color:red;">XXX</div> <!--90 char-->
        </div>
    </nav>
  <div class="col-md-12">
    <table class="table table-striped" id='tokensTable'>
    </table>
  </div>
	<div class="actionButtons" class="actionButtons">
		<button type="button" class="btn btn-success" id="updateButton" style="background-color: darkturquoise;">Update</button>
		<button type="button" class="btn btn-success" id="cancelButon" style="background-color: red;">Cancel</button>
	</div>
  <div class="modal fade" id="jsCookiesAlert" tabindex="-1" role="dialog" aria-labelledby="jsCookiesAlert" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Notice:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          This site requires cookies and JavaScript. Ensure that these are enabled on your browser.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Dismiss</button>
        </div>
      </div>
    </div>
  </div>

<script>
  var viewMode = false;
  $(function () {
    var findButtonDisabled;
		var formItems;
    var formData;
    var ajaxData;
    var enCldr = inzCldr();

    if (navigator.cookieEnabled == false) {
      $('#jsCookiesAlert').modal('show');
    }

    Globalize.locale("en");
    p = Globalize.dateParser();
    var z = p("6/12/2018");
    configureButtons(false, true, true);
    configureViewMode();
    $('.navbar-brand').click(function() {
      newFrame('views/QSECOFR_Main.html');
    }); 
    $('#UPView').click(function() {
      newFrame('views/userProfile_CRUD.html?mode=view');
    });
    $('#UPChange').click(function() {
      newFrame('views/userProfile_CRUD.html');
    });
    $('#STView').click(function() {
      newFrame('views/sessions_CRUD.html?mode=view');
    });
    $('#STChange').click(function() {
      newFrame('views/sessions_CRUD.html');
    });
    $('#UP1View').click(function() {
      newFrame('views/uniqueTokens_CRUD.html?mode=view');
    });
    $('#UP1Change').click(function() {
      newFrame('views/uniqueTokens_CRUD.html');
    });
    $('#UGView').click(function() {
      newFrame('views/userGroups_CRUD.html?mode=view');
    });
    $('#UGChange').click(function() {
      newFrame('views/userGroups_CRUD.html');
    });
    $('#PMView').click(function() {
      newFrame('views/permissionsMaster_CRUD.html?mode=view');
    });
    $('#PMChange').click(function() {
      newFrame('views/permissionsMaster_CRUD.html');
    });
    $('#GPView').click(function() {
      newFrame('views/groupPermissions_CRUD.html?mode=view');
    });
    $('#GPChange').click(function() {
      newFrame('views/groupPermissions_CRUD.html');
    });
    $('#GMView').click(function() {
      newFrame('views/groupMaster_CRUD.html?mode=view');
    });
    $('#GMChange').click(function() {
      newFrame('views/groupMaster_CRUD.html');
    });
    $('#PPView').click(function() {
      newFrame('views/passwordPolicy_CRUD.html?mode=view');
    });
    $('#PPChange').click(function() {
      newFrame('views/passwordPolicy_CRUD.html');
    });
    $('#findBtn').click(function(e) {

      if (navigator.cookieEnabled == false) {
        $('#jsCookiesAlert').modal('show');
      }

      e.preventDefault();
      setFormItems('find', ajaxData);
      setFormData();
      doPost();
    });
		$('#cancelButon').click(function() {
			configureButtons(false, true, true);
			$('#username').val('');
			$('#form-feedback').text('');
			$('#tokensTable').html('');
		}); 
		$('#updateButton').click(function() {
			if (validate()) {
				setFormItems('update', doUpdate());
      	setFormData();
      	doPost();
				configureButtons(false, true, true);
				$('#username').val('');
				$('#form-feedback').text('');
				$('#tokensTable').html('');
			}
		}); 
	});

  function doPost() {
    $.ajax({
      type:     'POST',
      url:      '../editUniqueTokens',
      data:     formData,
      dataType: "json", 
      success:  function (ajaxData) {
        ajaxSuccess(ajaxData);
      } 
    });
  }
  
  function ajaxSuccess(data) {
    setFormItems('ajaxSuccess', data);
  }
  
  function setFormItems(action, data) {
    if (
          action === 'find'
       ){
          formItems = {
            "action"               : action,
            "msgID"                : '',                      
            "msgDescription"       : '',                       
            "findUser"             : $('#username').val(),
						"up1UserName"					 : '',
            "up1Token"             : '',
            "up1DateAdded" 				 : '',
            "up1Rrn" 		           : '',
            "deleteToken"          : '',
            "uniqueTokensString"   : ''
          } 
        }
    
    if (action === 'ajaxSuccess') {
      formItems = {
        "action"                : action,
        "msgID"                 : data.msgID,                      
        "msgDescription"        : data.msgDescription,                       
        "findUser"              : data.findUser,
				"up1UserName"						: '',
        "up1Token"              : '',
        "up1DateAdded" 				  : '',
        "up1Rrn"	              : '',
        "deleteToken"           : '',
        "uniqueTokensString"    : data.uniqueTokensString
      }
			
			if (formItems.msgID === 'YRD0000') {
				if (getAllUrlParams().mode === 'view') {
					configureButtons(true, true, false);
				} else {
					configureButtons(true, false, false);
				}
				$('#form-feedback').text('');
				$('#tokensTable').html('');
				$('#tokensTable').append(
					   '<thead>'
           + '<tr id="tableHeaders">'
					 + '  <th style="width: 60%; padding: 0rem;">Token</th>'
        	 + '  <th style="width: 20%; padding: 0rem;">Date</th>'
					 + '  <th style="width: 10%; padding: 0rem;">RRN</th>'
					 + '  <th style="width: 10%; padding: 0rem;">DLT</th>'
        	 + '</tr>'
        	 + '</thead>'
        	 + '<tbody>'
      	);
				var tableRows = 0;
       	if (getAllUrlParams().mode != 'view') {
					$.each(JSON.parse(data.uniqueTokensString), function(key, value) {
						console.log('key:' + key 
												+ ' | up1Token:' 
												+ value.up1Token
												+ ' | up1DateAdded:' 
												+ value.up1DateAdded
												+ ' | up1Rrn:'
												+ value.up1Rrn
										 	);
						tableRows++;
						$('#tokensTable').append(
								'<tr class="tableRow existingToken" id="tableRow"> '
            	+ '<td id="userToken" style="width: 60%; padding: .75rem .75rem .75rem 0rem"> '
							+ '<input type="text" class="roundedCorners userToken1" name="userToken1" id="token'
							+ value.up1Rrn
							+ '" required size="70" value="'
							+ value.up1Token
							+ '"> '
							+ '</td>'
							
							+ '<td id="dateAdded" style="width: 20%; padding: .75rem .75rem .75rem 0rem"> '
            	+ '<div class="input-group date" id="datePicker"> '
            	+ '<input type="text" class="form-control tokenDate" name="tokenDate" required ' 
            	+ 'placeholder="mm/dd/yyyy" value="'
            	+ value.up1DateAdded
            	+ '">'
            	+ '<span class="input-group-addon">'
            	+ '<span class="glyphicon glyphicon-calendar"></span>'
            	+ '</span>'
            	+ '</div>'
            	+ '</td>'
							
            	+ '<td class="tokenRRN" style="width: 10%; padding: .75rem .75rem .75rem 0rem">'
            	+ value.up1Rrn
            	+ '</td>'
							
            	+ '<td id="tokenDLT" style="width: 10%; padding: .75rem .75rem .75rem 0rem">'
            	+ '<input class="dlt" type="checkbox" name="dlt" value=" ">'
            	+ '</td>'
            	+ '</tr>'
          	);
					} );
					console.log('tableRows: ' + tableRows);
					/*Add 10 extra rows for new tokens*/
					var i = 0;
					up1Rrn = -1;
					for (	i=0; i<10; i++, up1Rrn--) {
								$('#tokensTable').append(
									'<tr class="tableRow newToken" id="tableRow"> '
								+ '<td id="userToken" style="width: 60%; padding: .75rem .75rem .75rem 0rem"> '
								+ '<input type="text" class="roundedCorners userToken1" name="userToken1" id="token'
								+ up1Rrn
								+ '" size="70" value=""> '
								+ '</td>'
							
								+ '<td id="dateAdded" style="width: 20%; padding: .75rem .75rem .75rem 0rem"> '
            		+ '<div class="input-group date" id="datePicker"> '
            		+ '<input type="text" class="form-control tokenDate" name="tokenDate" required ' 
            		+ 'placeholder="mm/dd/yyyy" value="">'
            		+ '<span class="input-group-addon">'
            		+ '<span class="glyphicon glyphicon-calendar"></span>'
            		+ '</span>'
            		+ '</div>'
            		+ '</td>'
							
            		+ '<td class="tokenRRN" style="width: 10%; padding: .75rem .75rem .75rem 0rem">'
								+ up1Rrn
            		+ '</td>'
							
            		+ '<td id="tokenDLT" style="width: 10%; padding: .75rem .75rem .75rem 0rem">'
            		+ '</td>'
            		+ '</tr>'
							);
					}
				} else { /* view mode */
					$.each(JSON.parse(data.uniqueTokensString), function(key, value) {
						console.log('key:' + key 
												+ ' | up1Token:' 
												+ value.up1Token
												+ ' | up1DateAdded:' 
												+ value.up1DateAdded
												+ ' | up1Rrn:'
												+ value.up1Rrn
										 	);
						$('#tokensTable').append(
								'<tr class="tableRow existingToken" id="tableRow"> '
            	+ '<td id="userToken" style="width: 60%; padding: .75rem .75rem .75rem 0rem"> '
							+ value.up1Token
							+ '</td>'
							
							+ '<td id="dateAdded" style="width: 20%; padding: .75rem .75rem .75rem 0rem"> '
            	+ '<div class="input-group date" id="datePicker"> '
            	+ value.up1DateAdded
            	+ '</div>'
            	+ '</td>'
							
            	+ '<td class="tokenRRN" style="width: 10%; padding: .75rem .75rem .75rem 0rem">'
            	+ value.up1Rrn
            	+ '</td>'
							
            	+ '<td id="tokenDLT" style="width: 10%; padding: .75rem .75rem .75rem 0rem">'
            	+ '</td>'
            	+ '</tr>'
          	);
					} );
				}
				$('#tokensTable').append('</tbody>');
			} else {
				$('#form-feedback').text('No such user');
				configureButtons(false, true, true);
			}
		}
		
		if (action === 'update') {
      formItems = {
        "action"                : action,
        "msgID"                 : '',                      
        "msgDescription"        : '',                       
        "findUser"              : $('#username').val(),
				"up1UserName"						: '',
        "up1Token"              : '',
        "up1DateAdded" 				  : '',
        "up1Rrn"	              : '',
        "deleteToken"           : '',
        "uniqueTokensString"    : data
      }
		}
  }
  
  function setFormData() {
     formData = JSON.stringify(formItems);
  }

  function newFrame(newFrame) {
    $('html').html(newFrame);
    console.log(' nextFrame=' + newFrame);
    parent.frame = newFrame;
    parent.nextFrame();
  }

  function configureViewMode() {
    $('#title-loginID').text('Unique Tokens Maintenance    ' + parent.userName);
    viewMode = false;

    if (getAllUrlParams().mode === 'view') {
      viewMode = true;
      console.log('view mode');
      $('#title-loginID').text('Unique Tokens Maintenance    VIEW MODE    ' + parent.userName);
    }
  }
  
  function getAllUrlParams(url) {
    //see: https://www.sitepoint.com/get-url-parameters-with-javascript/
    // get query string from url (optional) or window
    var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

    // we'll store the parameters here
    var obj = {};

    // if query string exists
    if (queryString) {

      // stuff after # is not part of query string, so get rid of it
      queryString = queryString.split('#')[0];

      // split our query string into its component parts
      var arr = queryString.split('&');

      for (var i=0; i<arr.length; i++) {
        // separate the keys and the values
        var a = arr[i].split('=');

        // in case params look like: list[]=thing1&list[]=thing2
        var paramNum = undefined;
        var paramName = a[0].replace(/\[\d*\]/, function(v) {
          paramNum = v.slice(1,-1);
          return '';
        });

        // set parameter value (use 'true' if empty)
        var paramValue = typeof(a[1])==='undefined' ? true : a[1];

        // (optional) keep case consistent
        paramName = paramName.toLowerCase();
        paramValue = paramValue.toLowerCase();

        // if parameter name already exists
        if (obj[paramName]) {
          // convert value to array (if still string)
          if (typeof obj[paramName] === 'string') {
            obj[paramName] = [obj[paramName]];
          }
          // if no array index number specified...
          if (typeof paramNum === 'undefined') {
            // put the value on the end of the array
            obj[paramName].push(paramValue);
          }
          // if array index number specified...
          else {
            // put the value at that index number
            obj[paramName][paramNum] = paramValue;
          }
        }
        // if param name doesn't exist yet, set it
        else {
          obj[paramName] = paramValue;
        }
      }
    }

    return obj;
  }
	
	function configureButtons(findBtn, updateBtn, cancelBtn) {
    
		if (findBtn) {
			$('#findBtn')   .attr('disabled', true);
			$('#username')  .attr("disabled", true);
			findButtonDisabled = true;
		} else {
			$('#findBtn')   .attr('disabled', false);
			$('#username')  .attr("disabled", false);    
			findButtonDisabled = false;
		}                   
                          
		$('#updateButton').attr("disabled", updateBtn);
		$('#cancelButon') .attr("disabled", cancelBtn);
  }
	
	function doUpdate() {
		//https://stackoverflow.com/questions/17120633/loop-through-each-html-table-column-and-get-the-data-using-jquery
		var uniqueTokens = [];
		$('.existingToken').each(function(k, v) {
			var uniqueToken = {
													up1UserName:	$('#username').val(),
  												up1Token:			$(this).find('.userToken1').val(),
  												up1DateAdded:	$(this).find('.tokenDate').val(),
  												up1Rrn:				$(this).find('.tokenRRN').text(),
													deleteToken:	$(this).find('.dlt').is(':checked')
												};
			uniqueTokens.push(uniqueToken);
			console.log('doUpdate1: k=' + k + ' | v=' + v);
		});
		$('.newToken').each(function(k, v) {
			if ($(this).find('.userToken1').val() !== '' && $(this).find('.tokenDate').val() !=='') {
        var user      = $('#username').val().replace(/\s/g, '');
        var token     = $(this).find('.userToken1').val().replace(/\s/g, '');
        var dateAdded = $(this).find('.tokenDate').val().replace(/\s/g, '');
        var uniqueToken = {
													up1UserName:	user,
  												up1Token:			$(this).find('.userToken1').val().replace(/\s/g, ''),
  												up1DateAdded:	dateAdded,
  												up1Rrn:				$(this).find('.tokenRRN').text(),
													deleteToken:	$(this).find('.dlt').is(':checked')
												};
				uniqueTokens.push(uniqueToken);
				console.log('doUpdate2: k=' + k + ' | v=' + v);
			}
		});
		var x = JSON.stringify(uniqueTokens);
		console.log('uniqueTokens[] as JSON=' + x);
		return x;
	}
	
	function validate() {
		var isValid = true;
		Globalize.locale("en");
		var dateParser = Globalize.dateParser();
		$('.tableRow').each(function(k, v) {
			console.log('validate1: k=' + k + ' | v=' + v);
			$(this).find('.userToken1').removeClass('mediumRedBorder');
			$(this).find('.tokenDate').removeClass('mediumRedBorder');
			
			if (		$(this).find('.userToken1').val() === ''   						&&
					  	$(this).find('.tokenDate') .val() === ''									) { 

				if ($(this).find('.dlt').is(':checked') === false &&
					 	$(this).hasClass('existingToken')) {
					isValid = false;
					$(this).find('.userToken1').addClass('mediumRedBorder');
					$(this).find('.tokenDate') .addClass('mediumRedBorder');
				}	
			}
			
			if (		$(this).find('.userToken1').val() === ''   						&&
						!($(this).find('.tokenDate') .val() === '')									) {

				if ($(this).find('.dlt').is(':checked') === false) {
					isValid = false;
					$(this).find('.userToken1').addClass('mediumRedBorder');

					if (dateParser($(this).find('.tokenDate').val())===null) {
						isValid = false;
						$(this).find('.tokenDate').addClass('mediumRedBorder');
					}
				}
				
				if ($(this).hasClass('newToken')) {
					isValid = false;
					$(this).find('.userToken1').addClass('mediumRedBorder');

					if (dateParser($(this).find('.tokenDate').val())===null) {
						isValid = false;
						$(this).find('.tokenDate').addClass('mediumRedBorder');
					}
				}
			}
			
			if (	!($(this).find('.userToken1').val() === '')   					&&
							$(this).find('.tokenDate') .val() === ''									) {

				if (	$(this).find('.dlt').is(':checked') === false || 
							$(this).hasClass('newToken')) {
					isValid = false;
					$(this).find('.tokenDate').addClass('mediumRedBorder');
				}
			}
			
			if (	!($(this).find('.userToken1').val() === '')   && 
				 		!($(this).find('.tokenDate') .val() === '')							) {

				if (	$(this).find('.dlt').is(':checked') === false || 
							$(this).hasClass('newToken')) {

					if (dateParser($(this).find('.tokenDate').val())===null) {
						isValid = false;
						$(this).find('.tokenDate').addClass('mediumRedBorder');
					}
				}
			}
		});
		return isValid;
	}
</script>
</body>
</html>
